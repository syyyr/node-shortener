<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>URL Shortener service</title>
        <style>
@font-face {
    font-family: Helvetica;
    src: url("helvetica.otf");
}
p {
    font-size: 3em;
    display: inline;
}
body {
    font-family: "Helvetica";
    width: 90%;
    margin: auto;
}
#input {
    border: 2px solid;
    width: 100%;
    font-family: "Courier New", Courier, monospace;
}
.output {
    display: inline-block;
}
#link {
    font-family: "Courier New", Courier, monospace;
    display: inline-block;
}
.error {
    color: red;
    font-weight: bold;
}
        </style>
    </head>
    <body>
        <p>URL Shortener service</p>
        <input id="input">
        <button id="send">Shorten</button>
        <div id="output"></div>
        <script>
            const printError = (err) => {
                const output = document.createElement("div");
                output.className = "error";
                output.innerText = `ERROR: ${err}`
                document.getElementById("output").appendChild(output);
            }

            document.getElementById("send").onclick = async () => {
                document.getElementById("output").innerHTML = "";
                const value = document.getElementById("input").value;
                try {
                    const response = await fetch("/", {
                        body: JSON.stringify({ url: value }),
                        headers: {
                            "Content-Type": "application/json"
                        },
                        method: "POST"
                    });

                    if (!response.ok) {
                        printError(response.err);
                        return;
                    }

                    const json = await response.json();

                    if (!json.ok) {
                        printError(json.error);
                        return;
                    }

                    const output = document.createElement("div");
                    output.className = "output";
                    output.innerText = "Your link: ";
                    const url = `${document.URL}${json.short}`;
                    const link = document.createElement("a");
                    link.href = url;
                    link.innerText = url;
                    link.className = "link";
                    output.appendChild(link);
                    document.getElementById("output").appendChild(output);

                } catch (err) {
                    printError("Internal server error.");
                }
            };
        </script>
    </body>
</html>
